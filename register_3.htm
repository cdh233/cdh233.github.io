<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
				<meta name="robots" content="noindex, nofollow" />
				<title>Register - Sharp Sword 剑锋 OI</title>
		
		<script type="text/javascript">uojHome = 'http://swordoj.win'</script>

		<!-- Bootstrap core CSS -->
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />		<!-- Bootstrap theme -->
		<link type="text/css" rel="stylesheet" href="css/bootstrap-theme.min.css" />
		<!-- Custom styles for this template -->
		<link type="text/css" rel="stylesheet" href="css/uoj-theme.css" />		
		<!-- jQuery (necessary for Bootstrap\'s JavaScript plugins) -->
		<script src="js/jquery.min.js"></script>		
		<!-- jQuery autosize -->
		<script src="js/jquery.autosize.min.js"></script>		<script type="text/javascript">
			$(document).ready(function() {
				$('textarea').autosize();
			});
		</script>
		
		<!-- jQuery cookie -->
		<script src="js/jquery.cookie.min.js"></script>		
		<!-- jQuery modal -->
		<script src="js/jquery.modal.js"></script>		
		<!-- jQuery tag canvas -->
				
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="js/bootstrap.min.js"></script>		
		<!-- Color converter -->
		<script src="js/color-converter.min.js"></script>		
		<!-- uoj -->
		<script src="js/uoj.js"></script>		
		<!-- LAB -->
		<script src="js/LAB.min.js"></script>
		<!-- UOJ ico -->
		<link rel="shortcut icon" href="pictures/UOJ.ico" />
		
				
				
				<!-- MD5 -->
		<script src="js/md5.min.js"></script>				
				<!-- Bootstrap dialog -->
		<link type="text/css" rel="stylesheet" href="css/bootstrap-dialog.min.css" />		<script src="js/bootstrap-dialog.min.js"></script>				
				
				
				
		
				
				
				
				
				
		
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		
		<script type="text/javascript">
		before_window_unload_message = null;
		$(window).on('beforeunload', function() {
			if (before_window_unload_message !== null) {
			    return before_window_unload_message;
			}
		});
		</script>
		
			</head>
	<body role="document">
		<div class="container theme-showcase" role="main">
						<div>
				<ul class="nav nav-pills pull-right" role="tablist">
									<li role="presentation"><a href="login.htm">Login</a></li>
					<li role="presentation"><a href="register.htm">Register</a></li>
								</ul>
				<h1 class="hidden-xs"><a href="swordoj_default.html"><img src="pictures/UOJ_small.png" alt="UOJ Logo" class="img-rounded" style="width:39px; height:39px;" /></a> Sharp Sword 剑锋 OI</h1>
				<h1 class="visible-xs">SSOI</h1>
			</div>
			
			<div class="navbar navbar-default" role="navigation">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="swordoj_default.html">SSOI</a>
		</div>
		<div class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li><a href="contests.htm">Contests</a></li>
				<li><a href="problems.htm">Problems</a></li>
				<li><a href="submissions.htm">Submissions</a></li>
				<li><a href="hacks.htm">Hack!</a></li>
				<li><a href="blogs.htm">Blogs</a></li>
				<li><a href="faq.htm">Help</a></li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</div>
						
			<div class="uoj-content">
<h2 class="page-header">Register</h2>
<form id="form-register" class="form-horizontal">
	<div id="div-email" class="form-group">
		<label for="input-email" class="col-sm-2 control-label">Email</label>
		<div class="col-sm-3">
			<input type="email" class="form-control" id="input-email" name="email" placeholder="Enter your email" maxlength="50" />
			<span class="help-block" id="help-email"></span>
		</div>
	</div>
	<div id="div-username" class="form-group">
		<label for="input-username" class="col-sm-2 control-label">Username</label>
		<div class="col-sm-3">
			<input type="text" class="form-control" id="input-username" name="username" placeholder="Enter your username" maxlength="20" />
			<span class="help-block" id="help-username"></span>
		</div>
	</div>
	<div id="div-password" class="form-group">
		<label for="input-password" class="col-sm-2 control-label">Password</label>
		<div class="col-sm-3">
			<input type="password" class="form-control" id="input-password" name="password" placeholder="Enter your password" maxlength="20" />
			<input type="password" class="form-control top-buffer-sm" id="input-confirm_password" placeholder="Re-enter your password" maxlength="20" />
			<span class="help-block" id="help-password"></span>
		</div>
	</div>
	<div class="form-group">
		<div class="col-sm-offset-2 col-sm-3">
			<button type="submit" id="button-submit" class="btn btn-default">Submit</button>
		</div>
	</div>
</form>

<script type="text/javascript">
function checkUsernameNotInUse() {
	var ok = false;
	$.ajax({
		url : '/register',
		type : 'POST',
		dataType : 'json',
		async : false,
		
		data : {
			check_username : '',
			username : $('#input-username').val()
		},
		success : function(data) {
			ok = data.ok;
		},
		error :	function(XMLHttpRequest, textStatus, errorThrown) {
			alert(XMLHttpRequest.responseText);
			ok = false;
		}
	});
	return ok;
}
function validateRegisterPost() {
	var ok = true;
	ok &= getFormErrorAndShowHelp('email', validateEmail);
	ok &= getFormErrorAndShowHelp('username', function(str) {
		var err = validateUsername(str);
		if (err)
			return err;
		if (!checkUsernameNotInUse())
			return '该用户名已被人使用了。';
		return '';
	})
	ok &= getFormErrorAndShowHelp('password', validateSettingPassword);
	return ok;
}

function submitRegisterPost() {
	if (!validateRegisterPost()) {
		return;
	}
	
	$.post('/register', {
		_token : "mNoXoMCqWbqS68tnk3KVR3Gd6QCgmZDEW9PJeFLmIi0ydVdkyyRVZeLuRWNQ",
		register : '',
		username : $('#input-username').val(),
		email		: $('#input-email').val(),
		password : md5($('#input-password').val(), "a8Tk5f6iDq5HDpVK6monDICNUCpXOEvn")
	}, function(msg) {
		if (/^欢迎你！/.test(msg)) {
			BootstrapDialog.show({
				title	 : '注册成功',
				message : msg,
				type		: BootstrapDialog.TYPE_SUCCESS,
				buttons: [{
					label: '好的',
					action: function(dialog) {
						dialog.close();
					}
				}],
				onhidden : function(dialog) {
					var prevUrl = document.referrer;
					if (!prevUrl) {
						prevUrl = '/';
					};
					window.location.href = prevUrl;
				}
			});
		} else {
			BootstrapDialog.show({
				title	 : '注册失败',
				message : msg,
				type		: BootstrapDialog.TYPE_DANGER,
				buttons: [{
					label: '好的',
					action: function(dialog) {
						dialog.close();
					}
				}],
			});
		}
	});
}
$(document).ready(function() {
	$('#form-register').submit(function(e) {
		submitRegisterPost();
		return false;
	});
});
</script>
			</div>
						<div class="uoj-footer">
				<p>
					<a href="register_2.htm"><img src="http://img.uoj.ac/utility/flags/24/cn.png" alt="中文" /></a> 
					<a href="register_3.htm"><img src="http://img.uoj.ac/utility/flags/24/gb.png" alt="English" /></a>
				</p>
				
				<ul class="list-inline">
					<li>Sharp Sword 剑锋 OI</li>
									</ul>
				
				<p>Server time: 2018-05-07 15:42:16 | <a href="http://github.com/UniversalOJ/UOJ-System">开源项目</a></p>
			</div>
					</div>
		<!-- /container -->
	</body>
</html>
